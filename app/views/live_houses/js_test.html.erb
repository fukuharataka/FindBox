<!-- <div class="image_box b">
  <%= image_tag "no_image.png", size: '200x200' %>

  <form id="" action="">
    <input type="file" name="image" id="content" >
    <input type="submit" value="send">
  </form>

</div> -->


<div class="imgInput">
<%= image_tag "no_image.png", size: '200x200', class: "imgView" %>
<input type="file" name="file1">
</div>



<script>
$(function(){
    var setFileInput = $('.imgInput'),
    setFileImg = $('.imgView');

    setFileInput.each(function(){
        var selfFile = $(this),
        selfInput = $(this).find('input[type=file]'),
        prevElm = selfFile.find(setFileImg),
        orgPass = prevElm.attr('src');

        selfInput.change(function(){
            var file = $(this).prop('files')[0],
            fileRdr = new FileReader();

            if (!this.files.length){
                prevElm.attr('src', orgPass);
                return;
            } else {
                if (!file.type.match('image.*')){
                    prevElm.attr('src', orgPass);
                    return;
                } else {
                    fileRdr.onload = function() {
                        prevElm.attr('src', fileRdr.result);
                    }
                    fileRdr.readAsDataURL(file);
                }
            }

            var form = new FormData;
            form.append("Contnt-Type", file.type);
            form.append("photo[image]", file);
            console.log(file);
            console.log(form.photo);
            var xhr = new XMLHttpRequest;
            xhr.open("POST", "/photos.json", true);
            xhr.setRequestHeader("X-CSRF-Token", Rails.csrfToken());
            return xhr.send(form);
            console.log(xhr.readyStatus);
            if (xhr.status == 200) {
              var data = xhr.responseText;
              console.log(data);
            } else {
              console.log('通信失敗');
            }

        });
    });
});

</script>
